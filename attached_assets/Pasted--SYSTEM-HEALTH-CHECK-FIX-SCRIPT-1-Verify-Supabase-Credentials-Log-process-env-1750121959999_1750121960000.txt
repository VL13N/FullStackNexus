üöÄ SYSTEM HEALTH CHECK & FIX SCRIPT üöÄ

1. **Verify Supabase Credentials**  
   ‚Ä¢ Log process.env.SUPABASE_URL and process.env.SUPABASE_SERVICE_ROLE_KEY on server startup.  
   ‚Ä¢ If either is undefined, immediately throw a clear error: ‚ÄúMissing Supabase key: please define in Replit Secrets.‚Äù  

2. **Implement & Test /health/db Route**  
   ‚Ä¢ Create a new Express route GET /health/db that does:  
     const { data, error } = await supabase.from('live_predictions').select('id').limit(1);  
     return error ? res.status(500).json({ ok: false, error }) : res.json({ ok: true, sample: data });  
   ‚Ä¢ After deploying, run `curl http://localhost:5000/health/db` and require a 200 response with `{ ok: true }`.  

3. **Fix CryptoRank Sparkline Date Format**  
   ‚Ä¢ In your sparkline service, switch from URL-encoded ISO strings to JSON POST body or numeric timestamps:  
     ```js
     const from = Date.now() - 24*60*60*1000;
     const to   = Date.now();
     const body = { from, to, interval: '1h', sortBy:'date', sortDirection:'ASC', limit:100 };
     const res  = await fetch(`https://api.cryptorank.io/v2/currencies/${id}/sparkline`, {
       method: 'POST',
       headers: { 'X-API-KEY': CR_API_KEY, 'Content-Type':'application/json' },
       body: JSON.stringify(body)
     });
     ```  
   ‚Ä¢ Add a quick script `scripts/testSparkline.js` that prints `await res.json()` until you confirm an array of 24 points.  

4. **Verify LunarCrush API Connectivity**  
   ‚Ä¢ Log `!!process.env.LUNARCRUSH_API_KEY` at startup.  
   ‚Ä¢ Add a quick curl test in `scripts/testLunar.js`:  
     ```bash
     curl -H "Authorization: Bearer $LUNARCRUSH_API_KEY" \
          https://api.lunarcrush.com/v2?data=assets&symbol=SOL
     ```  
   ‚Ä¢ Ensure it returns valid JSON. If it errors, switch to v2:  
     `https://api.lunarcrush.com/v2?data=assets&key=$LUNARCRUSH_API_KEY&symbol=SOL`  

5. **End-to-End Smoke**  
   ‚Ä¢ After all fixes, hit:  
     - `GET /health/db` ‚Üí 200 OK  
     - `GET /api/cryptorank/currencies/5663/sparkline` ‚Üí 200 + 24 data points  
     - `GET /api/lunarcrush/metrics` ‚Üí 200 + valid social fields  
     - `GET /api/predictions/latest` ‚Üí 200 + persisted rows  

Reply with pass/fail for each check and any errors encountered.  
